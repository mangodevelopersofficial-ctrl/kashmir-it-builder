name: Mango Ultimate Multi-Platform Builder

on:
  workflow_dispatch:
    inputs:
      package_name:
        description: 'App Package Name'
        required: true
        default: 'com.mango.studio'
      app_name:
        description: 'Display Name'
        required: true
        default: 'Mango App'
      splash_time:
        description: 'Splash Screen Delay (ms)'
        required: true
        default: '3000'

jobs:
  build-android:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. Package Name aur App Name Change Karna
      - name: Customizing App Identity
        run: |
          # Change Package Name in Manifest and Build.gradle
          sed -i 's/com.old.package/${{ github.event.inputs.package_name }}/g' app/build.gradle
          sed -i 's/com.old.package/${{ github.event.inputs.package_name }}/g' app/src/main/AndroidManifest.xml
          
          # Change App Name in strings.xml
          sed -i 's/OldAppName/${{ github.event.inputs.app_name }}/g' app/src/main/res/values/strings.xml

      # 2. Splash Screen Timer Set Karna
      - name: Set Splash Delay
        run: |
          # Java code mein delay value replace karna
          sed -i 's/3000/${{ github.event.inputs.splash_time }}/g' app/src/main/java/com/mango/studio/SplashActivity.java

      # 3. Icons aur Images Replace Karna (Dashboard se aayi hui)
      - name: Injecting Branding
        run: |
          if [ -f "icon.png" ]; then cp icon.png app/src/main/res/mipmap-xxxhdpi/ic_launcher.png; fi
          if [ -f "splash.png" ]; then cp splash.png app/src/main/res/drawable/splash_screen.png; fi
          if [ -f "index.html" ]; then cp index.html app/src/main/assets/index.html; fi

      # 4. AdMob Configuration (Optional: Agar app code mein placeholders hon)
      - name: Setup Ads
        run: |
          echo "AdMob IDs injected"
          # Yahan aap sed command se java files mein IDs replace kar sakte hain

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Build APK & AAB
        run: |
          chmod +x gradlew
          ./gradlew assembleRelease
          ./gradlew bundleRelease

      # 5. Create GitHub Release (Direct Download Link ke liye)
      - name: Create Global Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ github.run_number }}
          name: Release v${{ github.run_number }}
          files: |
            app/build/outputs/apk/release/app-release.apk
            app/build/outputs/bundle/release/app-release.aab
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 6. Web Files (Index.html) ko alag Artifact banana
      - name: Upload Web Files
        uses: actions/upload-artifact@v4
        with:
          name: Web-Static-Files
          path: index.html
